import{j as e,r}from"./index-CQ6wr_3p.js";import{S as M,N as C}from"./Navbar-vdEESgna.js";import{u as A}from"./Camera Logo-BL-jRGp5.js";const D=({onClick:s})=>e.jsx("div",{onClick:s,className:"w-full aspect-[2/3] rounded-lg shadow-md border-2 border-violet-400 border-dashed bg-violet-100 flex items-center justify-center cursor-pointer hover:shadow-lg transition duration-300 hover:bg-violet-200 active:scale-95",children:e.jsx("div",{className:"bg-violet-600 rounded-xl p-5 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-4xl font-bold",children:"+"})})}),P="https://image.tmdb.org/t/p/w500",R=s=>s?`${P}${s}`:"../assets/Camera Logo.svg",k=s=>({id:s.id,title:s.title,overview:s.overview,posterPath:s.poster_path,voteAverage:s.vote_average,releaseDate:s.release_date,fullPosterPath:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:""}),E=({onClose:s,onAdd:a})=>{const[t,x]=r.useState(""),[p,i]=r.useState([]),[g,u]=r.useState(!1),[v,f]=r.useState(""),n=r.useRef(null);return r.useEffect(()=>{if(!t.trim()){i([]);return}return n.current&&clearTimeout(n.current),n.current=setTimeout(()=>{(async()=>{u(!0),f("");try{const l=await fetch(`https://localhost:7170/api/movies/search?query=${encodeURIComponent(t)}`);if(!l.ok){f("Failed to fetch results"),i([]);return}const j=await l.json();i(j||[])}catch(l){console.error("Error fetching movie suggestions:",l),f("An error occurred while searching"),i([])}finally{u(!1)}})()},300),()=>{n.current&&clearTimeout(n.current)}},[t]),e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg w-[500px] relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Search for a Movie"}),e.jsx("input",{type:"text",placeholder:"Search...",value:t,onChange:m=>x(m.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 mb-3"}),g&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Searching..."}),v&&e.jsx("p",{className:"text-sm text-red-500 mb-3",children:v}),e.jsx("div",{className:"flex justify-between gap-2 mb-4",children:p.slice(0,3).map(m=>{const l=k(m);return e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("img",{src:R(l.posterPath),alt:l.title,className:"w-[100px] h-[150px] object-cover rounded shadow cursor-pointer hover:scale-105 transition",onClick:()=>{a(l.id),s()}})},l.id)})}),e.jsx("button",{onClick:s,className:"mt-2 text-sm text-gray-500 hover:underline",children:"Close"})]})})},_="https://localhost:7170/api/movies",b=async s=>{try{const a=await fetch(`${_}/${s}`);if(!a.ok)throw new Error(`Failed to fetch movie data: ${a.statusText}`);const t=await a.json();return console.log("API Response:",t),{id:t.id,title:t.title,overview:t.overview,posterPath:t.poster_path??null,voteAverage:t.vote_average??0,releaseDate:t.release_date??null,fullPosterPath:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:""}}catch(a){return console.error("Error fetching movie:",a),null}},w=({movieId:s,asCard:a})=>{const[t,x]=r.useState(null);return r.useEffect(()=>{(async()=>{const i=await b(s);console.log("Fetched movie data:",i),i&&x(i)})()},[s]),t?a?e.jsx("img",{src:t.fullPosterPath,alt:t.title,className:"w-full aspect-[2/3] object-cover rounded-lg shadow-md"}):e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("img",{src:t.fullPosterPath,alt:t.title,className:"w-[200px] md:w-[250px] rounded-lg shadow"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:t.overview}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Rating:"})," ",t.voteAverage.toFixed(1)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Release Date:"})," ",t.releaseDate||"N/A"]})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Loading movie details..."})},$=({movieTitle:s,onConfirm:a,onCancel:t})=>e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg w-[500px] relative border border-red-700",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-red-500",children:"Confirm Removal"}),e.jsxs("p",{className:"text-gray-800 mb-6 text-sm",children:["Are you sure you want to remove ",e.jsx("strong",{children:s})," from your dashboard?"]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:t,className:"text-sm text-gray-600 hover:underline cursor-pointer transition duration-200",children:"Cancel"}),e.jsx("button",{onClick:a,className:"bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded text-sm cursor-pointer transition duration-200",children:"Remove"})]})]})}),B=()=>{const[s,a]=r.useState(!1),[t,x]=r.useState(null),[p,i]=r.useState([]),[g,u]=r.useState([]),[v,f]=r.useState("default"),{token:n}=A(),[m,l]=r.useState(null);r.useEffect(()=>{n&&(async()=>{const c=await fetch("https://localhost:7170/api/savedmovies",{headers:{Authorization:`Bearer ${n}`}});if(c.ok){const d=await c.json();i(d);const h=await Promise.all(d.map(S=>b(S)));u(h.filter(Boolean))}})()},[n]);const j=async o=>{if(p.includes(o))return;if((await fetch(`https://localhost:7170/api/savedmovies/${o}`,{method:"POST",headers:{Authorization:`Bearer ${n}`}})).ok){i(h=>[...h,o]);const d=await b(o);d&&u(h=>[...h,d])}},N=async o=>{(await fetch(`https://localhost:7170/api/savedmovies/${o}`,{method:"DELETE",headers:{Authorization:`Bearer ${n}`}})).ok&&(i(d=>d.filter(h=>h!==o)),u(d=>d.filter(h=>h.id!==o)))},y=[...g].sort((o,c)=>{switch(v){case"rating":return c.voteAverage-o.voteAverage;case"recent":return new Date(c.releaseDate||0).getTime()-new Date(o.releaseDate||0).getTime();case"az":return o.title.localeCompare(c.title);default:return 0}});return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:"w-[250px] bg-white shadow-md h-full",children:e.jsx(M,{})}),e.jsxs("div",{className:"flex flex-col flex-grow h-full",children:[e.jsx(C,{title:"Overview"}),e.jsxs("main",{className:"flex-grow overflow-y-auto bg-gradient-to-b bg-slate-100 p-10",children:[e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs("div",{children:[e.jsx("label",{className:"mr-2 text-sm font-medium text-slate-700",children:"Sort by:"}),e.jsxs("select",{className:"border rounded px-3 py-1 text-sm",value:v,onChange:o=>f(o.target.value),children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"rating",children:"Highest Rating"}),e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"az",children:"A-Z"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-6",children:[y.map(o=>e.jsxs("div",{title:o.title,className:"relative group transition-transform hover:scale-105 max-w-[300px] cursor-pointer animate-fade-in",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),l({id:o.id,title:o.title})},className:"absolute top-2 right-2 bg-red-500 text-white rounded-full px-2.5 py-1 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity z-10",title:"Remove movie",children:"×"}),e.jsx("div",{onClick:()=>x(o.id),children:e.jsx(w,{movieId:o.id,asCard:!0})})]},o.id)),e.jsx("div",{className:"max-w-[300px]",children:e.jsx(D,{onClick:()=>a(!0)})})]})]})]}),s&&e.jsx(E,{onClose:()=>a(!1),onAdd:j}),t!==null&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl max-w-4xl w-full flex gap-6 relative",children:[e.jsx("button",{className:"absolute top-4 right-4 text-xl font-bold text-indigo-700 hover:text-indigo-900",onClick:()=>x(null),children:"×"}),e.jsx(w,{movieId:t})]})}),m&&e.jsx($,{movieTitle:m.title,onCancel:()=>l(null),onConfirm:()=>{N(m.id),l(null)}})]})};export{B as default};
