import{r,j as s}from"./index-CW_5yktt.js";import{S as w,N as b}from"./Navbar-DcQspeYV.js";import{A as u,p as j}from"./api-BPstxoyE.js";import{u as y}from"./Camera Logo-BsrNr56R.js";const A=t=>({id:t.id,title:t.title,overview:t.overview,posterPath:t.poster_path,voteAverage:t.vote_average,releaseDate:t.release_date,fullPosterPath:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:""}),N=t=>t.replace(/[^\w\s]/gi,"").trim(),C=()=>{const[t,h]=r.useState(""),[p,v]=r.useState([]),[i,m]=r.useState([]),{token:a}=y(),d=r.useCallback(async()=>{const e=N(t),o=e?`${u}/movies/search?query=${encodeURIComponent(e)}&include_adult=true&language=en-US`:`${u}/movies/popular`,x=[...(await(await fetch(o)).json()).map(A)].sort((l,c)=>c.voteAverage===l.voteAverage?c.title.localeCompare(l.title):c.voteAverage-l.voteAverage);v(x)},[t]),n=r.useCallback(async()=>{if(a)try{const e=await fetch(`${u}/savedmovies`,{headers:{Authorization:`Bearer ${a}`}});if(!e.ok){console.error(`Failed to fetch saved movies: ${e.status}`);return}const o=await e.json();m(o)}catch(e){console.error("Error fetching saved movie IDs:",e)}},[a]);r.useEffect(()=>{a&&n()},[n,a]),r.useEffect(()=>{const e=setTimeout(async()=>{a&&await n(),await d()},200);return()=>clearTimeout(e)},[t,d,n,a]);const f=e=>{e.preventDefault(),d()},g=async e=>{if(!i.includes(e))try{await j(`/savedmovies/${e}`,{},a),m(o=>[...o,e])}catch(o){console.error("Error adding movie:",o),alert("An error occurred while saving the movie.")}};return s.jsxs("div",{className:"flex h-screen overflow-hidden",children:[s.jsx("aside",{className:"w-[250px] bg-white shadow-md h-full",children:s.jsx(w,{})}),s.jsxs("div",{className:"flex flex-col flex-grow h-full",children:[s.jsx(b,{title:"Find Movies"}),s.jsxs("main",{className:"flex-grow overflow-y-auto bg-gradient-to-b bg-slate-100 p-10",children:[s.jsx("form",{onSubmit:f,className:"mb-6 max-w-xl",children:s.jsx("input",{type:"text",value:t,onChange:e=>h(e.target.value),placeholder:"Search for a movie...",className:"border px-4 py-2 rounded w-full"})}),s.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-6",children:p.map(e=>s.jsxs("div",{className:"bg-white rounded shadow p-2 flex flex-col items-center transition-transform duration-300 hover:scale-[1.02] animate-fade-in",children:[s.jsx("img",{src:e.fullPosterPath??"",alt:e.title,loading:"lazy",title:e.title,className:"w-full aspect-[2/3] object-cover rounded"}),s.jsx("h3",{className:"mt-2 text-sm font-medium text-center",children:e.title}),s.jsx("button",{onClick:()=>g(e.id),className:`mt-2 px-3 py-1 rounded text-sm font-semibold transition cursor-pointer ${i.includes(e.id)?"bg-gray-400 text-white cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,disabled:i.includes(e.id),children:i.includes(e.id)?"Added":"Add"})]},e.id))})]})]})]})};export{C as default};
