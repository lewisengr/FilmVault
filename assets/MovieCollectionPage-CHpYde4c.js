import{r as a,j as e,a as A}from"./index-BilM2nAj.js";import{S as $,N as R}from"./Navbar-C64Dwuax.js";import{g as j,A as D,p as P,d as E}from"./api-BPstxoyE.js";const T=async(s,u)=>{try{const r=await j(`/movies/${s}`,u);return{id:r.id,title:r.title,overview:r.overview,posterPath:r.poster_path??null,voteAverage:r.vote_average??0,releaseDate:r.release_date??null,fullPosterPath:r.poster_path?`https://image.tmdb.org/t/p/w500${r.poster_path}`:null}}catch(r){return console.error("Error fetching movie:",r),null}},S=({movieId:s,asCard:u})=>{const[r,d]=a.useState(null);return a.useEffect(()=>{(async()=>{const m=await T(s);m&&d(m)})()},[s]),r?u?r.fullPosterPath?e.jsx("img",{src:r.fullPosterPath,alt:r.title,className:"w-full aspect-[2/3] object-cover rounded-lg shadow-md"}):null:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("img",{src:r.fullPosterPath??"",alt:r.title,className:"w-[200px] md:w-[250px] rounded-lg shadow"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:r.title}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:r.overview}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Rating:"})," ",r.voteAverage.toFixed(1)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Release Date:"})," ",r.releaseDate||"N/A"]})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Loading movie details..."})},z=({onClick:s})=>e.jsx("div",{onClick:s,className:"w-full aspect-[2/3] rounded-lg shadow-md border-2 border-violet-400 border-dashed bg-violet-100 flex items-center justify-center cursor-pointer hover:shadow-lg transition duration-300 hover:bg-violet-200 active:scale-95",children:e.jsx("div",{className:"bg-violet-600 rounded-xl p-5 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-4xl font-bold",children:"+"})})}),L="https://image.tmdb.org/t/p/w500",B=s=>s?`${L}${s}`:"../assets/Camera Logo.svg",U=s=>({id:s.id,title:s.title,overview:s.overview,posterPath:s.poster_path,voteAverage:s.vote_average,releaseDate:s.release_date,fullPosterPath:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:null}),F=({onClose:s,onAddToDashboard:u,onAddToWatchlist:r,isWatchlist:d=!1})=>{const[n,m]=a.useState(""),[b,v]=a.useState([]),[p,x]=a.useState(!1),[f,i]=a.useState(""),h=a.useRef(null);a.useEffect(()=>{if(!n.trim()){v([]);return}return h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{(async()=>{x(!0),i("");try{const l=await fetch(`${D}/movies/search?query=${encodeURIComponent(n.trim())}&include_adult=true&language=en-US`);if(!l.ok){i("Failed to fetch results"),v([]);return}const N=await l.json();v(N||[])}catch(l){console.error("Error fetching movie suggestions:",l),i("An error occurred while searching"),v([])}finally{x(!1)}})()},300),()=>{h.current&&clearTimeout(h.current)}},[n]);const w=c=>{d?r(c):u(c),s()};return e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg w-[500px] relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Search for a Movie"}),e.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:c=>m(c.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 mb-3"}),p&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Searching..."}),f&&e.jsx("p",{className:"text-sm text-red-500 mb-3",children:f}),e.jsx("div",{className:"flex justify-between gap-2 mb-4",children:b.slice(0,3).map(c=>{const l=U(c);return e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("img",{src:B(l.posterPath),alt:l.title,className:"w-[100px] h-[150px] object-cover rounded shadow cursor-pointer hover:scale-105 transition",onClick:()=>w(l.id)})},l.id)})}),e.jsx("button",{onClick:s,className:"mt-2 text-sm text-gray-500 hover:underline",children:"Close"})]})})},I=({apiPath:s,pageTitle:u,isWatchlist:r})=>{const[d,n]=a.useState([]),[m,b]=a.useState("default"),[v,p]=a.useState(!1),[x,f]=a.useState(null),{token:i}=A(),[h,w]=a.useState(!1),[c,l]=a.useState(!1),N=t=>({id:t.id,title:t.title,overview:t.overview,posterPath:t.poster_path,voteAverage:t.vote_average,releaseDate:t.release_date,fullPosterPath:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:""});a.useEffect(()=>{i&&(async()=>{try{const o=await j(`/${s}`,i),g=await Promise.all(o.map(async _=>{const k=await j(`/movies/${_}`,i);return N(k)}));n(g.filter(Boolean))}catch(o){console.error("Something went wrong. Try again.",o)}})()},[i,s]);const y=async t=>{if(!d.find(o=>o.id===t))try{await P(`/${s}/${t}`,{},i);const o=await j(`/movies/${t}`,i);n(g=>[...g,o])}catch(o){console.error(`Error adding to ${s}:`,o)}},M=async t=>{try{await E(`/${s}/${t}`,i),n(o=>o.filter(g=>g.id!==t)),f(null)}catch(o){console.error(`Failed to remove from ${s}`,o)}},C=a.useMemo(()=>[...d].sort((t,o)=>{switch(m){case"rating":return(o.voteAverage??0)-(t.voteAverage??0);case"recent":return new Date(o.releaseDate??"").getTime()-new Date(t.releaseDate??"").getTime();case"az":return t.title.localeCompare(o.title);default:return 0}}),[d,m]);return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:`
      bg-white shadow-md h-full w-[250px] z-40
      fixed sm:relative sm:top-0 sm:left-0 top-[64px] left-0 
      transform transition-transform duration-300 ease-in-out
      ${h?"translate-x-0":"-translate-x-full sm:translate-x-0"}
    `,children:e.jsx($,{})}),e.jsx("button",{onClick:()=>w(t=>!t),className:"sm:hidden fixed top-[90px] left-4 z-50 bg-white shadow p-2 rounded",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5m-16.5 5.25h16.5m-16.5 5.25h16.5"})})}),e.jsxs("div",{className:"flex flex-col flex-grow h-full",children:[e.jsx(R,{title:u}),e.jsxs("main",{className:"flex-grow overflow-y-auto bg-gradient-to-b bg-slate-100 p-10",children:[e.jsxs("div",{className:"flex justify-end mb-6",children:[e.jsx("label",{className:"mr-2 text-sm font-medium text-slate-700",children:"Sort by:"}),e.jsxs("select",{className:"border rounded px-3 py-1 text-sm",value:m,onChange:t=>b(t.target.value),children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"rating",children:"Highest Rating"}),e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"az",children:"A-Z"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[C.map(t=>e.jsx("div",{title:t.title,onClick:()=>f(t),className:"bg-white rounded shadow p-2 flex flex-col items-center transition-transform duration-300 hover:scale-[1.02] cursor-pointer animate-fade-in",children:e.jsx(S,{movieId:t.id,asCard:!0})},t.id)),e.jsx("div",{className:"max-w-[300px]",children:e.jsx(z,{onClick:()=>p(!0)})})]})]})]}),v&&e.jsx(F,{isWatchlist:r,onClose:()=>p(!1),onAddToDashboard:r?()=>{}:y,onAddToWatchlist:r?y:()=>{}}),x&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl max-w-4xl w-full flex flex-col gap-6 relative",children:[e.jsx("button",{className:"absolute top-4 right-4 text-xl font-bold text-indigo-700 hover:text-indigo-900",onClick:()=>f(null),children:"x"}),e.jsx(S,{movieId:x.id}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>l(!0),className:"border border-red-600 text-red-600 font-semibold py-2 px-4 rounded hover:bg-red-50 transition cursor-pointer",children:"Remove Movie"})})]})}),c&&x&&e.jsx("div",{className:"fixed inset-0 bg-opacity-40 backdrop-blur-sm z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-[300px]",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-800 mb-4 text-center",children:["Remove ",e.jsx("span",{className:"font-bold",children:x.title}),"?"]}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsx("button",{className:"text-sm text-gray-600 hover:underline  cursor-pointer",onClick:()=>l(!1),children:"Cancel"}),e.jsx("button",{onClick:()=>{M(x.id),l(!1)},className:"border border-red-600 text-red-600 px-4 py-1.5 rounded font-semibold hover:bg-red-50 transition cursor-pointer",children:"Confirm"})]})]})})]})};export{I as M};
