import{r as a,j as e}from"./index-CW_5yktt.js";import{S as A,N as k}from"./Navbar-DcQspeYV.js";import{g as w,A as D,p as $,d as R}from"./api-BPstxoyE.js";import{u as _}from"./Camera Logo-BsrNr56R.js";const P=async(t,i)=>{try{const s=await w(`/movies/${t}`,i);return{id:s.id,title:s.title,overview:s.overview,posterPath:s.poster_path??null,voteAverage:s.vote_average??0,releaseDate:s.release_date??null,fullPosterPath:s.poster_path?`https://image.tmdb.org/t/p/w500${s.poster_path}`:null}}catch(s){return console.error("Error fetching movie:",s),null}},S=({movieId:t,asCard:i})=>{const[s,m]=a.useState(null);return a.useEffect(()=>{(async()=>{const h=await P(t);h&&m(h)})()},[t]),s?i?s.fullPosterPath?e.jsx("img",{src:s.fullPosterPath,alt:s.title,className:"w-full aspect-[2/3] object-cover rounded-lg shadow-md"}):null:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("img",{src:s.fullPosterPath??"",alt:s.title,className:"w-[200px] md:w-[250px] rounded-lg shadow"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:s.title}),e.jsx("p",{className:"text-sm text-slate-600 mb-4",children:s.overview}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Rating:"})," ",s.voteAverage.toFixed(1)]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Release Date:"})," ",s.releaseDate||"N/A"]})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Loading movie details..."})},E=({onClick:t})=>e.jsx("div",{onClick:t,className:"w-full aspect-[2/3] rounded-lg shadow-md border-2 border-violet-400 border-dashed bg-violet-100 flex items-center justify-center cursor-pointer hover:shadow-lg transition duration-300 hover:bg-violet-200 active:scale-95",children:e.jsx("div",{className:"bg-violet-600 rounded-xl p-5 flex items-center justify-center",children:e.jsx("span",{className:"text-white text-4xl font-bold",children:"+"})})}),B="https://image.tmdb.org/t/p/w500",T=t=>t?`${B}${t}`:"../assets/Camera Logo.svg",z=t=>({id:t.id,title:t.title,overview:t.overview,posterPath:t.poster_path,voteAverage:t.vote_average,releaseDate:t.release_date,fullPosterPath:t.poster_path?`https://image.tmdb.org/t/p/w500${t.poster_path}`:null}),L=({onClose:t,onAddToDashboard:i,onAddToWatchlist:s,isWatchlist:m=!1})=>{const[n,h]=a.useState(""),[N,g]=a.useState([]),[j,f]=a.useState(!1),[p,v]=a.useState(""),c=a.useRef(null);a.useEffect(()=>{if(!n.trim()){g([]);return}return c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{(async()=>{f(!0),v("");try{const l=await fetch(`${D}/movies/search?query=${encodeURIComponent(n.trim())}&include_adult=true&language=en-US`);if(!l.ok){v("Failed to fetch results"),g([]);return}const b=await l.json();g(b||[])}catch(l){console.error("Error fetching movie suggestions:",l),v("An error occurred while searching"),g([])}finally{f(!1)}})()},300),()=>{c.current&&clearTimeout(c.current)}},[n]);const d=u=>{m?s(u):i(u),t()};return e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg w-[500px] relative",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Search for a Movie"}),e.jsx("input",{type:"text",placeholder:"Search...",value:n,onChange:u=>h(u.target.value),className:"w-full border border-gray-300 rounded px-3 py-2 mb-3"}),j&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Searching..."}),p&&e.jsx("p",{className:"text-sm text-red-500 mb-3",children:p}),e.jsx("div",{className:"flex justify-between gap-2 mb-4",children:N.slice(0,3).map(u=>{const l=z(u);return e.jsx("div",{className:"flex flex-col items-center",children:e.jsx("img",{src:T(l.posterPath),alt:l.title,className:"w-[100px] h-[150px] object-cover rounded shadow cursor-pointer hover:scale-105 transition",onClick:()=>d(l.id)})},l.id)})}),e.jsx("button",{onClick:t,className:"mt-2 text-sm text-gray-500 hover:underline",children:"Close"})]})})},F=({movieTitle:t,onConfirm:i,onCancel:s})=>e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg w-[500px] relative border border-red-700",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-red-500",children:"Confirm Removal"}),e.jsxs("p",{className:"text-gray-800 mb-6 text-sm",children:["Are you sure you want to remove ",e.jsx("strong",{children:t})," from your dashboard?"]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:s,className:"text-sm text-gray-600 hover:underline cursor-pointer transition duration-200",children:"Cancel"}),e.jsx("button",{onClick:i,className:"bg-red-500 hover:bg-red-700 text-white px-4 py-2 rounded text-sm cursor-pointer transition duration-200",children:"Remove"})]})]})}),H=({apiPath:t,pageTitle:i,isWatchlist:s})=>{const[m,n]=a.useState([]),[h,N]=a.useState("default"),[g,j]=a.useState(!1),[f,p]=a.useState(null),[v,c]=a.useState(null),{token:d}=_(),[u,l]=a.useState(!1);a.useEffect(()=>{d&&(async()=>{try{const o=await w(`/${t}`,d),x=await Promise.all(o.map(y=>w(`/movies/${y}`,d)));n(x.filter(Boolean))}catch(o){console.error(`Failed to load ${t}`,o)}})()},[d,t]);const b=async r=>{if(!m.find(o=>o.id===r))try{await $(`/${t}/${r}`,{},d);const o=await w(`/movies/${r}`,d);n(x=>[...x,o])}catch(o){console.error(`Error adding to ${t}:`,o)}},M=async r=>{try{await R(`/${t}/${r}`,d),n(o=>o.filter(x=>x.id!==r))}catch(o){console.error(`Failed to remove from ${t}`,o)}},C=[...m].sort((r,o)=>{switch(h){case"rating":{const x=r.voteAverage??0;return(o.voteAverage??0)-x}case"recent":{const x=r.releaseDate?new Date(r.releaseDate).getTime():0;return(o.releaseDate?new Date(o.releaseDate).getTime():0)-x}case"az":return r.title.localeCompare(o.title);default:return 0}});return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsx("aside",{className:`
    bg-white shadow-md h-full w-[250px] z-40
    sm:relative sm:translate-x-0 sm:transition-none
    fixed top-0 left-0 transform transition-transform duration-300 ease-in-out
    ${u?"translate-x-0":"-translate-x-full sm:translate-x-0"}
  `,children:e.jsx(A,{})}),e.jsxs("div",{className:"flex flex-col flex-grow h-full",children:[e.jsx("button",{onClick:()=>l(r=>!r),className:"sm:hidden absolute top-4 left-4 z-50 bg-white shadow p-2 rounded",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5m-16.5 5.25h16.5m-16.5 5.25h16.5"})})}),e.jsx(k,{title:i}),e.jsxs("main",{className:"flex-grow overflow-y-auto bg-gradient-to-b bg-slate-100 p-10",children:[e.jsxs("div",{className:"flex justify-end mb-6",children:[e.jsx("label",{className:"mr-2 text-sm font-medium text-slate-700",children:"Sort by:"}),e.jsxs("select",{className:"border rounded px-3 py-1 text-sm",value:h,onChange:r=>N(r.target.value),children:[e.jsx("option",{value:"default",children:"Default"}),e.jsx("option",{value:"rating",children:"Highest Rating"}),e.jsx("option",{value:"recent",children:"Most Recent"}),e.jsx("option",{value:"az",children:"A-Z"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[C.map(r=>e.jsxs("div",{title:r.title,className:"bg-white rounded shadow p-2 flex flex-col items-center transition-transform duration-300 hover:scale-[1.02] cursor-pointer animate-fade-in relative group",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),c({id:r.id,title:r.title})},className:"absolute top-3 right-3 bg-red-500 text-white rounded-full px-2.5 py-1 text-sm font-bold opacity-0 group-hover:opacity-100 transition-opacity z-10",title:"Remove movie",children:"x"}),e.jsx("div",{onClick:()=>p(r.id),children:e.jsx(S,{movieId:r.id,asCard:!0})})]},r.id)),e.jsx("div",{className:"max-w-[300px]",children:e.jsx(E,{onClick:()=>j(!0)})})]})]})]}),g&&e.jsx(L,{isWatchlist:s,onClose:()=>j(!1),onAddToDashboard:s?()=>{}:b,onAddToWatchlist:s?b:()=>{}}),f!==null&&e.jsx("div",{className:"fixed inset-0 backdrop-blur-sm bg-slate-700/25 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-2xl max-w-4xl w-full flex gap-6 relative",children:[e.jsx("button",{className:"absolute top-4 right-4 text-xl font-bold text-indigo-700 hover:text-indigo-900",onClick:()=>p(null),children:"x"}),e.jsx(S,{movieId:f})]})}),v&&e.jsx(F,{movieTitle:v.title,onCancel:()=>c(null),onConfirm:()=>{M(v.id),c(null)}})]})};export{H as M};
